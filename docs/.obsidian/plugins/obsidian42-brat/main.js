"use strict";var Xe=Object.create;var K=Object.defineProperty;var et=Object.getOwnPropertyDescriptor;var tt=Object.getOwnPropertyNames;var nt=Object.getPrototypeOf,it=Object.prototype.hasOwnProperty;var st=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),ot=(s,e)=>{for(var n in e)K(s,n,{get:e[n],enumerable:!0})},ye=(s,e,n,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of tt(e))!it.call(s,i)&&i!==n&&K(s,i,{get:()=>e[i],enumerable:!(t=et(e,i))||t.enumerable});return s};var at=(s,e,n)=>(n=s!=null?Xe(nt(s)):{},ye(e||!s||!s.__esModule?K(n,"default",{value:s,enumerable:!0}):n,s)),rt=s=>ye(K({},"__esModule",{value:!0}),s);var Qe=st(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});var f=require("obsidian"),ce="YYYY-MM-DD",pe="gggg-[W]ww",xe="YYYY-MM",Re="YYYY-[Q]Q",Oe="YYYY";function _(s){var n,t;let e=window.app.plugins.getPlugin("periodic-notes");return e&&((t=(n=e.settings)==null?void 0:n[s])==null?void 0:t.enabled)}function H(){var s,e,n,t;try{let{internalPlugins:i,plugins:o}=window.app;if(_("daily")){let{format:r,folder:p,template:w}=((e=(s=o.getPlugin("periodic-notes"))==null?void 0:s.settings)==null?void 0:e.daily)||{};return{format:r||ce,folder:(p==null?void 0:p.trim())||"",template:(w==null?void 0:w.trim())||""}}let{folder:a,format:l,template:g}=((t=(n=i.getPluginById("daily-notes"))==null?void 0:n.instance)==null?void 0:t.options)||{};return{format:l||ce,folder:(a==null?void 0:a.trim())||"",template:(g==null?void 0:g.trim())||""}}catch(i){console.info("No custom daily note settings found!",i)}}function Y(){var s,e,n,t,i,o,a;try{let l=window.app.plugins,g=(s=l.getPlugin("calendar"))==null?void 0:s.options,r=(n=(e=l.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.weekly;if(_("weekly"))return{format:r.format||pe,folder:((t=r.folder)==null?void 0:t.trim())||"",template:((i=r.template)==null?void 0:i.trim())||""};let p=g||{};return{format:p.weeklyNoteFormat||pe,folder:((o=p.weeklyNoteFolder)==null?void 0:o.trim())||"",template:((a=p.weeklyNoteTemplate)==null?void 0:a.trim())||""}}catch(l){console.info("No custom weekly note settings found!",l)}}function j(){var e,n,t,i;let s=window.app.plugins;try{let o=_("monthly")&&((n=(e=s.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.monthly)||{};return{format:o.format||xe,folder:((t=o.folder)==null?void 0:t.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom monthly note settings found!",o)}}function q(){var e,n,t,i;let s=window.app.plugins;try{let o=_("quarterly")&&((n=(e=s.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.quarterly)||{};return{format:o.format||Re,folder:((t=o.folder)==null?void 0:t.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom quarterly note settings found!",o)}}function W(){var e,n,t,i;let s=window.app.plugins;try{let o=_("yearly")&&((n=(e=s.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.yearly)||{};return{format:o.format||Oe,folder:((t=o.folder)==null?void 0:t.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom yearly note settings found!",o)}}function ze(...s){let e=[];for(let t=0,i=s.length;t<i;t++)e=e.concat(s[t].split("/"));let n=[];for(let t=0,i=e.length;t<i;t++){let o=e[t];!o||o==="."||n.push(o)}return e[0]===""&&n.unshift(""),n.join("/")}function mt(s){let e=s.substring(s.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function ft(s){let e=s.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let n=ze(...e);window.app.vault.getAbstractFileByPath(n)||await window.app.vault.createFolder(n)}}async function J(s,e){e.endsWith(".md")||(e+=".md");let n=f.normalizePath(ze(s,e));return await ft(n),n}async function I(s){let{metadataCache:e,vault:n}=window.app,t=f.normalizePath(s);if(t==="/")return Promise.resolve(["",null]);try{let i=e.getFirstLinkpathDest(t,""),o=await n.cachedRead(i),a=window.app.foldManager.load(i);return[o,a]}catch(i){return console.error(`Failed to read the daily note template '${t}'`,i),new f.Notice("Failed to read the daily note template"),["",null]}}function S(s,e="day"){let n=s.clone().startOf(e).format();return`${e}-${n}`}function Ve(s){return s.replace(/\[[^\]]*\]/g,"")}function ht(s,e){if(e==="week"){let n=Ve(s);return/w{1,2}/i.test(n)&&(/M{1,4}/.test(n)||/D{1,4}/.test(n))}return!1}function E(s,e){return Ue(s.basename,e)}function bt(s,e){return Ue(mt(s),e)}function Ue(s,e){let t={day:H,week:Y,month:j,quarter:q,year:W}[e]().format.split("/").pop(),i=window.moment(s,t,!0);if(!i.isValid())return null;if(ht(t,e)&&e==="week"){let o=Ve(t);if(/w{1,2}/i.test(o))return window.moment(s,t.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return i}var me=class extends Error{};async function _e(s){let e=window.app,{vault:n}=e,t=window.moment,{template:i,format:o,folder:a}=H(),[l,g]=await I(i),r=s.format(o),p=await J(a,r);try{let w=await n.create(p,l.replace(/{{\s*date\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,t().format("HH:mm")).replace(/{{\s*title\s*}}/gi,r).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,h,v,b,m,T)=>{let ie=t(),se=s.clone().set({hour:ie.get("hour"),minute:ie.get("minute"),second:ie.get("second")});return v&&se.add(parseInt(b,10),m),T?se.format(T.substring(1).trim()):se.format(o)}).replace(/{{\s*yesterday\s*}}/gi,s.clone().subtract(1,"day").format(o)).replace(/{{\s*tomorrow\s*}}/gi,s.clone().add(1,"d").format(o)));return e.foldManager.save(w,g),w}catch(w){console.error(`Failed to create file: '${p}'`,w),new f.Notice("Unable to create new file.")}}function wt(s,e){var n;return(n=e[S(s,"day")])!=null?n:null}function yt(){let{vault:s}=window.app,{folder:e}=H(),n=s.getAbstractFileByPath(f.normalizePath(e));if(!n)throw new me("Failed to find daily notes folder");let t={};return f.Vault.recurseChildren(n,i=>{if(i instanceof f.TFile){let o=E(i,"day");if(o){let a=S(o,"day");t[a]=i}}}),t}var fe=class extends Error{};function vt(){let{moment:s}=window,e=s.localeData()._week.dow,n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)n.push(n.shift()),e--;return n}function Tt(s){return vt().indexOf(s.toLowerCase())}async function He(s){let{vault:e}=window.app,{template:n,format:t,folder:i}=Y(),[o,a]=await I(n),l=s.format(t),g=await J(i,l);try{let r=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(p,w,d,h,v,b)=>{let m=window.moment(),T=s.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return d&&T.add(parseInt(h,10),v),b?T.format(b.substring(1).trim()):T.format(t)}).replace(/{{\s*title\s*}}/gi,l).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(p,w,d)=>{let h=Tt(w);return s.weekday(h).format(d.trim())}));return window.app.foldManager.save(r,a),r}catch(r){console.error(`Failed to create file: '${g}'`,r),new f.Notice("Unable to create new file.")}}function Pt(s,e){var n;return(n=e[S(s,"week")])!=null?n:null}function St(){let s={};if(!je())return s;let{vault:e}=window.app,{folder:n}=Y(),t=e.getAbstractFileByPath(f.normalizePath(n));if(!t)throw new fe("Failed to find weekly notes folder");return f.Vault.recurseChildren(t,i=>{if(i instanceof f.TFile){let o=E(i,"week");if(o){let a=S(o,"week");s[a]=i}}}),s}var he=class extends Error{};async function Ye(s){let{vault:e}=window.app,{template:n,format:t,folder:i}=j(),[o,a]=await I(n),l=s.format(t),g=await J(i,l);try{let r=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(p,w,d,h,v,b)=>{let m=window.moment(),T=s.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return d&&T.add(parseInt(h,10),v),b?T.format(b.substring(1).trim()):T.format(t)}).replace(/{{\s*date\s*}}/gi,l).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,l));return window.app.foldManager.save(r,a),r}catch(r){console.error(`Failed to create file: '${g}'`,r),new f.Notice("Unable to create new file.")}}function Ct(s,e){var n;return(n=e[S(s,"month")])!=null?n:null}function At(){let s={};if(!qe())return s;let{vault:e}=window.app,{folder:n}=j(),t=e.getAbstractFileByPath(f.normalizePath(n));if(!t)throw new he("Failed to find monthly notes folder");return f.Vault.recurseChildren(t,i=>{if(i instanceof f.TFile){let o=E(i,"month");if(o){let a=S(o,"month");s[a]=i}}}),s}var be=class extends Error{};async function Ft(s){let{vault:e}=window.app,{template:n,format:t,folder:i}=q(),[o,a]=await I(n),l=s.format(t),g=await J(i,l);try{let r=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(p,w,d,h,v,b)=>{let m=window.moment(),T=s.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return d&&T.add(parseInt(h,10),v),b?T.format(b.substring(1).trim()):T.format(t)}).replace(/{{\s*date\s*}}/gi,l).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,l));return window.app.foldManager.save(r,a),r}catch(r){console.error(`Failed to create file: '${g}'`,r),new f.Notice("Unable to create new file.")}}function Nt(s,e){var n;return(n=e[S(s,"quarter")])!=null?n:null}function kt(){let s={};if(!We())return s;let{vault:e}=window.app,{folder:n}=q(),t=e.getAbstractFileByPath(f.normalizePath(n));if(!t)throw new be("Failed to find quarterly notes folder");return f.Vault.recurseChildren(t,i=>{if(i instanceof f.TFile){let o=E(i,"quarter");if(o){let a=S(o,"quarter");s[a]=i}}}),s}var we=class extends Error{};async function Lt(s){let{vault:e}=window.app,{template:n,format:t,folder:i}=W(),[o,a]=await I(n),l=s.format(t),g=await J(i,l);try{let r=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(p,w,d,h,v,b)=>{let m=window.moment(),T=s.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return d&&T.add(parseInt(h,10),v),b?T.format(b.substring(1).trim()):T.format(t)}).replace(/{{\s*date\s*}}/gi,l).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,l));return window.app.foldManager.save(r,a),r}catch(r){console.error(`Failed to create file: '${g}'`,r),new f.Notice("Unable to create new file.")}}function Bt(s,e){var n;return(n=e[S(s,"year")])!=null?n:null}function Dt(){let s={};if(!Je())return s;let{vault:e}=window.app,{folder:n}=W(),t=e.getAbstractFileByPath(f.normalizePath(n));if(!t)throw new we("Failed to find yearly notes folder");return f.Vault.recurseChildren(t,i=>{if(i instanceof f.TFile){let o=E(i,"year");if(o){let a=S(o,"year");s[a]=i}}}),s}function It(){var t,i;let{app:s}=window,e=s.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let n=s.plugins.getPlugin("periodic-notes");return n&&((i=(t=n.settings)==null?void 0:t.daily)==null?void 0:i.enabled)}function je(){var n,t;let{app:s}=window;if(s.plugins.getPlugin("calendar"))return!0;let e=s.plugins.getPlugin("periodic-notes");return e&&((t=(n=e.settings)==null?void 0:n.weekly)==null?void 0:t.enabled)}function qe(){var n,t;let{app:s}=window,e=s.plugins.getPlugin("periodic-notes");return e&&((t=(n=e.settings)==null?void 0:n.monthly)==null?void 0:t.enabled)}function We(){var n,t;let{app:s}=window,e=s.plugins.getPlugin("periodic-notes");return e&&((t=(n=e.settings)==null?void 0:n.quarterly)==null?void 0:t.enabled)}function Je(){var n,t;let{app:s}=window,e=s.plugins.getPlugin("periodic-notes");return e&&((t=(n=e.settings)==null?void 0:n.yearly)==null?void 0:t.enabled)}function Et(s){let e={day:H,week:Y,month:j,quarter:q,year:W}[s];return e()}function Mt(s,e){return{day:_e,month:Ye,week:He}[s](e)}u.DEFAULT_DAILY_NOTE_FORMAT=ce;u.DEFAULT_MONTHLY_NOTE_FORMAT=xe;u.DEFAULT_QUARTERLY_NOTE_FORMAT=Re;u.DEFAULT_WEEKLY_NOTE_FORMAT=pe;u.DEFAULT_YEARLY_NOTE_FORMAT=Oe;u.appHasDailyNotesPluginLoaded=It;u.appHasMonthlyNotesPluginLoaded=qe;u.appHasQuarterlyNotesPluginLoaded=We;u.appHasWeeklyNotesPluginLoaded=je;u.appHasYearlyNotesPluginLoaded=Je;u.createDailyNote=_e;u.createMonthlyNote=Ye;u.createPeriodicNote=Mt;u.createQuarterlyNote=Ft;u.createWeeklyNote=He;u.createYearlyNote=Lt;u.getAllDailyNotes=yt;u.getAllMonthlyNotes=At;u.getAllQuarterlyNotes=kt;u.getAllWeeklyNotes=St;u.getAllYearlyNotes=Dt;u.getDailyNote=wt;u.getDailyNoteSettings=H;u.getDateFromFile=E;u.getDateFromPath=bt;u.getDateUID=S;u.getMonthlyNote=Ct;u.getMonthlyNoteSettings=j;u.getPeriodicNoteSettings=Et;u.getQuarterlyNote=Nt;u.getQuarterlyNoteSettings=q;u.getTemplateInfo=I;u.getWeeklyNote=Pt;u.getWeeklyNoteSettings=Y;u.getYearlyNote=Bt;u.getYearlyNoteSettings=W});var $t={};ot($t,{default:()=>ne});module.exports=rt($t);var Ze=require("obsidian");var A=require("obsidian");var lt=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,oe=s=>{if(typeof s!="string")throw new TypeError("Invalid argument expected string");let e=s.match(lt);if(!e)throw new Error(`Invalid argument not valid semver ('${s}' received)`);return e.shift(),e},ve=s=>s==="*"||s==="x"||s==="X",Te=s=>{let e=parseInt(s,10);return isNaN(e)?s:e},gt=(s,e)=>typeof s!=typeof e?[String(s),String(e)]:[s,e],ut=(s,e)=>{if(ve(s)||ve(e))return 0;let[n,t]=gt(Te(s),Te(e));return n>t?1:n<t?-1:0},ae=(s,e)=>{for(let n=0;n<Math.max(s.length,e.length);n++){let t=ut(s[n]||"0",e[n]||"0");if(t!==0)return t}return 0};var re=(s,e)=>{let n=oe(s),t=oe(e),i=n.pop(),o=t.pop(),a=ae(n,t);return a!==0?a:i&&o?ae(i.split("."),o.split(".")):i||o?i?-1:1:0};var C=require("obsidian");var le=async(s,e=!0,n="")=>{let t=`https://api.github.com/repos/${s}`;try{let i=await(0,C.request)({url:t,headers:n?{Authorization:`Token ${n}`}:{}});return(await JSON.parse(i)).private}catch(i){return e&&console.log("error in isPrivateRepo",t,i),!1}},Pe=async(s,e=!0,n="")=>{let t=`https://api.github.com/repos/${s}/releases`;try{let i=await(0,C.request)({url:t,headers:{Authorization:`Token ${n}`}});return(await JSON.parse(i)).map(a=>({version:a.tag_name,prerelease:a.prerelease}))}catch(i){return e&&console.log("error in fetchReleaseVersions",t,i),null}},M=async(s,e,n=!0,t=!1,i="")=>{try{let o=s.assets.find(g=>g.name===e);if(!o)return null;let a={Accept:"application/octet-stream"};(t&&i||i)&&(a.Authorization=`Token ${i}`);let l=await(0,C.request)({url:o.url,headers:a});return l==="Not Found"||l==='{"error":"Not Found"}'?null:l}catch(o){return n&&console.log("error in grabReleaseFileFromRepository",URL,o),null}},Se=async(s=!0)=>{let e="https://raw.githubusercontent.com/obsidianmd/obsidian-releases/HEAD/community-plugins.json";try{let n=await(0,C.request)({url:e});return n==="404: Not Found"?null:await JSON.parse(n)}catch(n){return s&&console.log("error in grabCommmunityPluginList",n),null}},Ce=async(s=!0)=>{let e="https://raw.githubusercontent.com/obsidianmd/obsidian-releases/HEAD/community-css-themes.json";try{let n=await(0,C.request)({url:e});return n==="404: Not Found"?null:await JSON.parse(n)}catch(n){return s&&console.log("error in grabCommmunityThemesList",n),null}},L=async(s,e=!1,n=!1)=>{let t=`https://raw.githubusercontent.com/${s}/HEAD/theme${e?"-beta":""}.css`;try{let i=await(0,C.request)({url:t});return i==="404: Not Found"?null:i}catch(i){return n&&console.log("error in grabCommmunityThemeCssFile",i),null}},Ae=async(s,e=!0)=>{let n=`https://raw.githubusercontent.com/${s}/HEAD/manifest.json`;try{let t=await(0,C.request)({url:n});return t==="404: Not Found"?null:t}catch(t){return e&&console.log("error in grabCommmunityThemeManifestFile",t),null}},dt=s=>{let e=0;for(let n=0;n<s.length;n++)e+=s.charCodeAt(n);return e},$=s=>dt(s).toString(),x=async(s,e,n)=>{let t=await L(s,e,n);return t?$(t):"0"},ct=async(s,e,n=!0)=>{let t=`https://api.github.com/repos/${s}/commits?path=${e}&page=1&per_page=1`;try{let i=await(0,C.request)({url:t});return i==="404: Not Found"?null:JSON.parse(i)}catch(i){return n&&console.log("error in grabLastCommitInfoForAFile",i),null}},Fe=async(s,e)=>{var t;let n=await ct(s,e);return n&&n.length>0&&((t=n[0].commit.committer)!=null&&t.date)?n[0].commit.committer.date:""},ge=async(s,e,n=!1,t=!1,i=!1,o)=>{var a;try{let l=e?`https://api.github.com/repos/${s}/releases/tags/${e}`:`https://api.github.com/repos/${s}/releases`,g={Accept:"application/vnd.github.v3+json"};(i&&o||o)&&(g.Authorization=`Token ${o}`);let r=await(0,C.request)({url:l,headers:g});if(r==="404: Not Found")return null;let p=e?[JSON.parse(r)]:JSON.parse(r);return t&&console.log(`grabReleaseFromRepository for ${s}:`,p),(a=p.sort((w,d)=>re(d.tag_name,w.tag_name)).filter(w=>n||!w.prerelease)[0])!=null?a:null}catch(l){return t&&console.log(`Error in grabReleaseFromRepository for ${s}:`,l),null}};var ue={pluginList:[],pluginSubListFrozenVersion:[],themesList:[],updateAtStartup:!0,updateThemesAtStartup:!0,enableAfterInstall:!0,loggingEnabled:!1,loggingPath:"BRAT-log",loggingVerboseEnabled:!1,debuggingMode:!1,notificationsEnabled:!0,personalAccessToken:""};function Ne(s,e,n=""){let t=!1;s.settings.pluginList.contains(e)||(s.settings.pluginList.unshift(e),t=!0),n!==""&&s.settings.pluginSubListFrozenVersion.filter(i=>i.repo===e).length===0&&(s.settings.pluginSubListFrozenVersion.unshift({repo:e,version:n}),t=!0),t&&s.saveSettings()}function ke(s,e){return s.settings.pluginList.contains(e)}function Le(s,e,n){let t={repo:e,lastUpdate:$(n)};s.settings.themesList.unshift(t),s.saveSettings()}function Be(s,e){return!!s.settings.themesList.find(t=>t.repo===e)}function De(s,e,n){for(let t of s.settings.themesList)t.repo===e&&(t.lastUpdate=n,s.saveSettings())}var R=require("obsidian");var G=require("obsidian");function c(s,e,n=10,t){if(!s.settings.notificationsEnabled)return;let i=t?G.Platform.isDesktop?"(click=dismiss, right-click=Info)":"(click=dismiss)":"",o=new G.Notice(`BRAT
${e}
${i}`,n*1e3);t&&(o.noticeEl.oncontextmenu=()=>{t()})}var B=(s,e=!0)=>{let n=s.createEl("div");n.style.float="right",e?(n.style.padding="15px",n.style.paddingLeft="15px",n.style.paddingRight="15px",n.style.marginLeft="15px"):(n.style.padding="10px",n.style.paddingLeft="15px",n.style.paddingRight="15px");let t=n.createDiv("coffee");t.addClass("ex-twitter-span"),t.style.paddingLeft="10px";let i=t.createDiv();i.innerText="Learn more about my work at:",t.appendChild(i);let o=t.createEl("a",{href:"https://tfthacker.com"});return o.innerText="https://tfthacker.com",n};var N=class extends R.Modal{constructor(e,n,t=!1,i=!1,o=""){super(e.app),this.plugin=e,this.betaPlugins=n,this.address=o,this.openSettingsTabAfterwards=t,this.useFrozenVersion=i,this.enableAfterInstall=e.settings.enableAfterInstall,this.version="",this.versionSetting=null,this.addPluginButton=null}async submitForm(){if(this.address==="")return;let e=this.address.replace("https://github.com/","");e.endsWith(".git")&&(e=e.slice(0,-4));let n=this.plugin.settings.pluginSubListFrozenVersion.find(i=>i.repo===e);if(n){n.version=this.version,await this.plugin.saveSettings(),await this.betaPlugins.addPlugin(e,!1,!1,!1,this.version,!0,this.enableAfterInstall)&&this.close();return}if(ke(this.plugin,e)){c(this.plugin,"This plugin is already in the list for beta testing",10);return}await this.betaPlugins.addPlugin(e,!1,!1,!1,this.version,!1,this.enableAfterInstall)&&this.close()}updateVersionDropdown(e,n){e.clear(),e.addDropdown(t=>{t.addOption("","Select a version");for(let i of n)t.addOption(i.version,`${i.version} ${i.prerelease?"(Prerelease)":""}`);t.onChange(i=>{this.version=i,this.addPluginButton&&(this.version!==""?this.addPluginButton.disabled=!1:this.addPluginButton.disabled=!0)}),t.selectEl.style.width="100%"})}onOpen(){this.contentEl.createEl("h4",{text:this.useFrozenVersion?this.address?"Update frozen version of plugin:":"Github repository for frozen beta plugin:":"Github repository for beta plugin:"}),this.contentEl.createEl("form",{},e=>{e.addClass("brat-modal"),new R.Setting(e).addText(i=>{i.setPlaceholder("Repository (example: https://github.com/GitubUserName/repository-name)"),i.setValue(this.address),this.address&&(i.setDisabled(!0),window.setTimeout(async()=>{await this.updateVersionDropwdown(i)},100)),i.onChange(o=>{this.address=o.trim(),this.useFrozenVersion&&this.address===""&&this.versionSetting&&(this.updateVersionDropdown(this.versionSetting,[]),this.versionSetting.settingEl.classList.add("disabled-setting"),this.versionSetting.setDisabled(!0),i.inputEl.classList.remove("valid-repository"),i.inputEl.classList.remove("invalid-repository"))}),i.inputEl.addEventListener("keydown",async o=>{o.key==="Enter"&&(this.address!==" "&&(this.useFrozenVersion&&this.version!==""||!this.useFrozenVersion)&&(o.preventDefault(),this.submitForm()),await this.updateVersionDropwdown(i))}),i.inputEl.addEventListener("blur",async()=>{await this.updateVersionDropwdown(i)}),i.inputEl.style.width="100%"}),this.useFrozenVersion&&(this.versionSetting=new R.Setting(e).setClass("version-setting").setClass("disabled-setting"),this.updateVersionDropdown(this.versionSetting,[]),this.versionSetting.setDisabled(!0)),e.createDiv("modal-button-container",i=>{i.createEl("label",{cls:"mod-checkbox"},o=>{let a=o.createEl("input",{attr:{tabindex:-1},type:"checkbox"});a.checked=this.enableAfterInstall,a.addEventListener("click",()=>{this.enableAfterInstall=a.checked}),o.appendText("Enable after installing the plugin")}),i.createEl("button",{attr:{type:"button"},text:"Never mind"}).addEventListener("click",()=>{this.close()}),this.addPluginButton=i.createEl("button",{attr:{type:"submit"},cls:"mod-cta",text:this.useFrozenVersion&&this.address?"Change Version":"Add Plugin"}),this.useFrozenVersion&&(this.addPluginButton.disabled=!0)});let n=e.createDiv();n.style.borderTop="1px solid #ccc",n.style.marginTop="30px";let t=n.createSpan();t.innerHTML="BRAT by <a href='https://bit.ly/o42-twitter'>TFTHacker</a>",t.style.fontStyle="italic",n.appendChild(t),B(n,!1),window.setTimeout(()=>{let i=e.querySelectorAll(".brat-modal .setting-item-info");for(let o of Array.from(i))o.remove()},50),e.addEventListener("submit",i=>{i.preventDefault(),this.address!==""&&(this.useFrozenVersion&&this.version!==""||!this.useFrozenVersion)&&this.submitForm()})})}async updateVersionDropwdown(e){if(this.useFrozenVersion&&this.address){this.versionSetting&&this.updateVersionDropdown(this.versionSetting,[]);let n=this.address.replace("https://github.com/","");n.endsWith(".git")&&(n=n.slice(0,-4));let t=await Pe(n,this.plugin.settings.debuggingMode,this.plugin.settings.personalAccessToken);t&&t.length>0?(e.inputEl.classList.remove("invalid-repository"),e.inputEl.classList.add("valid-repository"),this.versionSetting&&(this.versionSetting.settingEl.classList.remove("disabled-setting"),this.versionSetting.setDisabled(!1),this.updateVersionDropdown(this.versionSetting,t))):(e.inputEl.classList.remove("valid-repository"),e.inputEl.classList.add("invalid-repository"),this.versionSetting&&(this.versionSetting.settingEl.classList.add("disabled-setting"),this.versionSetting.setDisabled(!0),this.addPluginButton&&(this.addPluginButton.disabled=!0)))}}onClose(){this.openSettingsTabAfterwards&&(this.plugin.app.setting.open(),this.plugin.app.setting.openTabById(this.plugin.APP_ID))}};var Ie=require("obsidian");async function Z(){try{let s=await(0,Ie.requestUrl)(`https://obsidian.md/?${Math.random()}`);return s.status>=200&&s.status<300}catch(s){return!1}}var O=class{constructor(e){this.plugin=e}displayAddNewPluginModal(e=!1,n=!1,t=""){new N(this.plugin,this,e,n,t).open()}async validateRepository(e,n=!1,t=!1,i=""){let a=await le(e,this.plugin.settings.debuggingMode,this.plugin.settings.personalAccessToken),l=await ge(e,i,n,this.plugin.settings.debuggingMode,a,this.plugin.settings.personalAccessToken);if(!l)return t&&(c(this.plugin,`${e}
This does not seem to be an obsidian plugin with valid releases, as there are no releases available.`,15),console.error("BRAT: validateRepository",e,n,t)),null;let g=await M(l,"manifest.json",this.plugin.settings.debuggingMode,a,this.plugin.settings.personalAccessToken);if(!g)return t&&(c(this.plugin,`${e}
This does not seem to be an obsidian plugin, as there is no manifest.json file.`,15),console.error("BRAT: validateRepository",e,n,t)),null;let r=JSON.parse(g);return"id"in r?"version"in r?r:(t&&c(this.plugin,`${e}
The version attribute for the release is missing from the manifest file`,15),null):(t&&c(this.plugin,`${e}
The plugin id attribute for the release is missing from the manifest file`,15),null)}async getAllReleaseFiles(e,n,t,i=""){let o=await le(e,this.plugin.settings.debuggingMode,this.plugin.settings.personalAccessToken),a=await ge(e,i,t,this.plugin.settings.debuggingMode,o,this.plugin.settings.personalAccessToken);if(!a)return Promise.reject("No release found");let l=t||i!=="";return console.log({reallyGetManifestOrNot:l,version:a.tag_name}),{mainJs:await M(a,"main.js",this.plugin.settings.debuggingMode,o,this.plugin.settings.personalAccessToken),manifest:l?await M(a,"manifest.json",this.plugin.settings.debuggingMode,o,this.plugin.settings.personalAccessToken):"",styles:await M(a,"styles.css",this.plugin.settings.debuggingMode,o,this.plugin.settings.personalAccessToken)}}async writeReleaseFilesToPluginFolder(e,n){var o,a;let t=`${(0,A.normalizePath)(`${this.plugin.app.vault.configDir}/plugins/${e}`)}/`,{adapter:i}=this.plugin.app.vault;await i.exists(t)||await i.mkdir(t),await i.write(`${t}main.js`,(o=n.mainJs)!=null?o:""),await i.write(`${t}manifest.json`,(a=n.manifest)!=null?a:""),n.styles&&await i.write(`${t}styles.css`,n.styles)}async addPlugin(e,n=!1,t=!1,i=!1,o="",a=!1,l=this.plugin.settings.enableAfterInstall){this.plugin.settings.debuggingMode&&console.log("BRAT: addPlugin",e,n,t,i,o,a,l);let g=10,r=await this.validateRepository(e,!0,!1,o),p=!!r;if(p||(r=await this.validateRepository(e,!1,!0,o)),r===null){let d=`${e}
A manifest.json file does not exist in the latest release of the repository. This plugin cannot be installed.`;return await this.plugin.log(d,!0),c(this.plugin,d,g),!1}if(!Object.hasOwn(r,"version")){let d=`${e}
The manifest.json file in the latest release or pre-release of the repository does not have a version number in the file. This plugin cannot be installed.`;return await this.plugin.log(d,!0),c(this.plugin,d,g),!1}if(!Object.hasOwn(r,"minAppVersion")&&!(0,A.requireApiVersion)(r.minAppVersion)){let d=`Plugin: ${e}

The manifest.json for this plugin indicates that the Obsidian version of the app needs to be ${r.minAppVersion}, but this installation of Obsidian is ${A.apiVersion}. 

You will need to update your Obsidian to use this plugin or contact the plugin developer for more information.`;return await this.plugin.log(d,!0),c(this.plugin,d,30),!1}let w=async()=>{let d=await this.getAllReleaseFiles(e,r,p,o);if(console.log("rFiles",d),(p||d.manifest==="")&&(d.manifest=JSON.stringify(r)),this.plugin.settings.debuggingMode&&console.log("BRAT: rFiles.manifest",p,d),d.mainJs===null){let h=`${e}
The release is not complete and cannot be download. main.js is missing from the Release`;return await this.plugin.log(h,!0),c(this.plugin,h,g),null}return d};if(!n||a){let d=await w();if(d===null)return!1;if(await this.writeReleaseFilesToPluginFolder(r.id,d),a||Ne(this.plugin,e,o),l){let{plugins:h}=this.plugin.app,v=(0,A.normalizePath)(`${h.getPluginFolder()}/${r.id}`);await h.loadManifest(v),await h.enablePluginAndSave(r.id)}if(await this.plugin.app.plugins.loadManifests(),a)await this.reloadPlugin(r.id),await this.plugin.log(`${e} reinstalled`,!0),c(this.plugin,`${e}
Plugin has been reinstalled and reloaded.`,g);else{let h=o===""?"":` (version: ${o})`,v=`${e}${h}
The plugin has been registered with BRAT.`;l||(v+=" You may still need to enable it the Community Plugin List."),await this.plugin.log(v,!0),c(this.plugin,v,g)}}else{let d=`${this.plugin.app.vault.configDir}/plugins/${r.id}/`,h="";try{h=await this.plugin.app.vault.adapter.read(`${d}manifest.json`)}catch(b){if(b.errno===-4058||b.errno===-2)return await this.addPlugin(e,!1,p,!1,o),!0;console.log("BRAT - Local Manifest Load",r.id,JSON.stringify(b,null,2))}if(o!==""||this.plugin.settings.pluginSubListFrozenVersion.map(b=>b.repo).includes(e))return c(this.plugin,`The version of ${e} is frozen, not updating.`,3),!1;let v=await JSON.parse(h);if(v.version!==r.version){let b=await w();if(b===null)return!1;if(t){let m=`There is an update available for ${r.id} from version ${v.version} to ${r.version}. `;await this.plugin.log(`${m}[Release Info](https://github.com/${e}/releases/tag/${r.version})`,!0),c(this.plugin,m,30,()=>{r&&window.open(`https://github.com/${e}/releases/tag/${r.version}`)})}else{await this.writeReleaseFilesToPluginFolder(r.id,b),await this.plugin.app.plugins.loadManifests(),await this.reloadPlugin(r.id);let m=`${r.id}
Plugin has been updated from version ${v.version} to ${r.version}. `;await this.plugin.log(`${m}[Release Info](https://github.com/${e}/releases/tag/${r.version})`,!0),c(this.plugin,m,30,()=>{r&&window.open(`https://github.com/${e}/releases/tag/${r.version}`)})}}else i&&c(this.plugin,`No update available for ${e}`,3)}return!0}async reloadPlugin(e){let{plugins:n}=this.plugin.app;try{await n.disablePlugin(e),await n.enablePlugin(e)}catch(t){this.plugin.settings.debuggingMode&&console.log("reload plugin",t)}}async updatePlugin(e,n=!1,t=!1,i=!1){let o=await this.addPlugin(e,!0,n,t,"",i);return!o&&!n&&c(this.plugin,`${e}
Update of plugin failed.`),o}async checkForPluginUpdatesAndInstallUpdates(e=!1,n=!1){if(!await Z()){console.log("BRAT: No internet detected.");return}let t,i="Checking for plugin updates STARTED";await this.plugin.log(i,!0),e&&this.plugin.settings.notificationsEnabled&&(t=new A.Notice(`BRAT
${i}`,3e4));let o=new Set(this.plugin.settings.pluginSubListFrozenVersion.map(l=>l.repo));for(let l of this.plugin.settings.pluginList)o.has(l)||await this.updatePlugin(l,n);let a="Checking for plugin updates COMPLETED";await this.plugin.log(a,!0),e&&(t&&t.hide(),c(this.plugin,a,10))}deletePlugin(e){let n=`Removed ${e} from BRAT plugin list`;this.plugin.log(n,!0),this.plugin.settings.pluginList=this.plugin.settings.pluginList.filter(t=>t!==e),this.plugin.settings.pluginSubListFrozenVersion=this.plugin.settings.pluginSubListFrozenVersion.filter(t=>t.repo!==e),this.plugin.saveSettings()}getEnabledDisabledPlugins(e){let n=this.plugin.app.plugins,t=Object.values(n.manifests),i=Object.values(n.plugins).map(o=>o.manifest);return e?t.filter(o=>i.find(a=>o.id===a.id)):t.filter(o=>!i.find(a=>o.id===a.id))}};var k=require("obsidian");var z=async(s,e,n)=>{let t=await L(e,!0,s.settings.debuggingMode);if(t||(t=await L(e,!1,s.settings.debuggingMode)),!t)return c(s,"There is no theme.css or theme-beta.css file in the root path of this repository, so there is no theme to install."),!1;let i=await Ae(e,s.settings.debuggingMode);if(!i)return c(s,"There is no manifest.json file in the root path of this repository, so theme cannot be installed."),!1;let o=await JSON.parse(i),a=(0,k.normalizePath)(pt(s)+o.name),{adapter:l}=s.app.vault;await l.exists(a)||await l.mkdir(a),await l.write((0,k.normalizePath)(`${a}/theme.css`),t),await l.write((0,k.normalizePath)(`${a}/manifest.json`),i),De(s,e,$(t));let g="";return n?(Le(s,e,t),g=`${o.name} theme installed from ${e}. `,setTimeout(()=>{s.app.customCss.setTheme(o.name)},500)):g=`${o.name} theme updated from ${e}.`,s.log(`${g}[Theme Info](https://github.com/${e})`,!1),c(s,g,20,()=>{window.open(`https://github.com/${e}`)}),!0},D=async(s,e)=>{if(!await Z()){console.log("BRAT: No internet detected.");return}let n,t="Checking for beta theme updates STARTED";await s.log(t,!0),e&&s.settings.notificationsEnabled&&(n=new k.Notice(`BRAT
${t}`,3e4));for(let o of s.settings.themesList){let a=await x(o.repo,!0,s.settings.debuggingMode);a==="0"&&(a=await x(o.repo,!1,s.settings.debuggingMode)),console.log("BRAT: lastUpdateOnline",a),a!==o.lastUpdate&&await z(s,o.repo,!1)}let i="Checking for beta theme updates COMPLETED";(async()=>await s.log(i,!0))(),e&&(s.settings.notificationsEnabled&&n&&n.hide(),c(s,i))},X=(s,e)=>{s.settings.themesList=s.settings.themesList.filter(t=>t.repo!==e),s.saveSettings();let n=`Removed ${e} from BRAT themes list and will no longer be updated. However, the theme files still exist in the vault. To remove them, go into Settings > Appearance and remove the theme.`;s.log(n,!0),c(s,n)},pt=s=>`${(0,k.normalizePath)(`${s.app.vault.configDir}/themes`)}/`;var ee=require("obsidian");var F=class extends ee.Modal{constructor(e,n=!1){super(e.app),this.plugin=e,this.address="",this.openSettingsTabAfterwards=n}async submitForm(){if(this.address==="")return;let e=this.address.replace("https://github.com/","");if(Be(this.plugin,e)){c(this.plugin,"This theme is already in the list for beta testing",10);return}await z(this.plugin,e,!0)&&this.close()}onOpen(){this.contentEl.createEl("h4",{text:"Github repository for beta theme:"}),this.contentEl.createEl("form",{},e=>{e.addClass("brat-modal"),new ee.Setting(e).addText(i=>{i.setPlaceholder("Repository (example: https://github.com/GitubUserName/repository-name"),i.setValue(this.address),i.onChange(o=>{this.address=o.trim()}),i.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.address!==" "&&(o.preventDefault(),this.submitForm())}),i.inputEl.style.width="100%",window.setTimeout(()=>{let o=document.querySelector(".setting-item-info");o&&o.remove(),i.inputEl.focus()},10)}),e.createDiv("modal-button-container",i=>{i.createEl("button",{attr:{type:"button"},text:"Never mind"}).addEventListener("click",()=>{this.close()}),i.createEl("button",{attr:{type:"submit"},cls:"mod-cta",text:"Add Theme"})});let n=e.createDiv();n.style.borderTop="1px solid #ccc",n.style.marginTop="30px";let t=n.createSpan();t.innerHTML="BRAT by <a href='https://bit.ly/o42-twitter'>TFTHacker</a>",t.style.fontStyle="italic",n.appendChild(t),B(n,!1),window.setTimeout(()=>{let i=e.querySelectorAll(".brat-modal .setting-item-info");for(let o of Array.from(i))o.remove()},50),e.addEventListener("submit",i=>{i.preventDefault(),this.address!==""&&this.submitForm()})})}onClose(){this.openSettingsTabAfterwards&&(this.plugin.app.setting.openTab(),this.plugin.app.setting.openTabById(this.plugin.APP_ID))}};var Ee=require("obsidian"),P=class extends Ee.FuzzySuggestModal{constructor(n){super(n.app);this.data=[];this.scope.register(["Shift"],"Enter",t=>{this.enterTrigger(t)}),this.scope.register(["Ctrl"],"Enter",t=>{this.enterTrigger(t)})}setSuggesterData(n){this.data=n}display(n){this.callbackFunction=n,this.open()}getItems(){return this.data}getItemText(n){return n.display}onChooseItem(){}renderSuggestion(n,t){t.createEl("div",{text:n.item.display})}enterTrigger(n){var o;let t=(o=document.querySelector(".suggestion-item.is-selected div"))==null?void 0:o.textContent,i=this.data.find(a=>a.display===t);i&&(this.invokeCallback(i,n),this.close())}onChooseSuggestion(n,t){this.invokeCallback(n.item,t)}invokeCallback(n,t){typeof this.callbackFunction=="function"&&this.callbackFunction(n,t)}};var V=class{constructor(e){this.bratCommands=[{id:"AddBetaPlugin",icon:"BratIcon",name:"Plugins: Add a beta plugin for testing",showInRibbon:!0,callback:()=>{this.plugin.betaPlugins.displayAddNewPluginModal(!1,!1)}},{id:"AddBetaPluginWithFrozenVersion",icon:"BratIcon",name:"Plugins: Add a beta plugin with frozen version based on a release tag",showInRibbon:!0,callback:()=>{this.plugin.betaPlugins.displayAddNewPluginModal(!1,!0)}},{id:"checkForUpdatesAndUpdate",icon:"BratIcon",name:"Plugins: Check for updates to all beta plugins and UPDATE",showInRibbon:!0,callback:async()=>{await this.plugin.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!0,!1)}},{id:"checkForUpdatesAndDontUpdate",icon:"BratIcon",name:"Plugins: Only check for updates to beta plugins, but don't Update",showInRibbon:!0,callback:async()=>{await this.plugin.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!0,!0)}},{id:"updateOnePlugin",icon:"BratIcon",name:"Plugins: Choose a single plugin version to update",showInRibbon:!0,callback:()=>{let e=new Set(this.plugin.settings.pluginSubListFrozenVersion.map(i=>i.repo)),n=Object.values(this.plugin.settings.pluginList).filter(i=>!e.has(i)).map(i=>({display:i,info:i})),t=new P(this.plugin);t.setSuggesterData(n),t.display(i=>{let o=`Checking for updates for ${i.info}`;this.plugin.log(o,!0),c(this.plugin,`
${o}`,3),this.plugin.betaPlugins.updatePlugin(i.info,!1,!0)})}},{id:"reinstallOnePlugin",icon:"BratIcon",name:"Plugins: Choose a single plugin to reinstall",showInRibbon:!0,callback:()=>{let e=new Set(this.plugin.settings.pluginSubListFrozenVersion.map(i=>i.repo)),n=Object.values(this.plugin.settings.pluginList).filter(i=>!e.has(i)).map(i=>({display:i,info:i})),t=new P(this.plugin);t.setSuggesterData(n),t.display(i=>{let o=`Reinstalling ${i.info}`;c(this.plugin,`
${o}`,3),this.plugin.log(o,!0),this.plugin.betaPlugins.updatePlugin(i.info,!1,!1,!0)})}},{id:"restartPlugin",icon:"BratIcon",name:"Plugins: Restart a plugin that is already installed",showInRibbon:!0,callback:()=>{let e=Object.values(this.plugin.app.plugins.manifests).map(t=>({display:t.id,info:t.id})),n=new P(this.plugin);n.setSuggesterData(e),n.display(t=>{c(this.plugin,`${t.info}
Plugin reloading .....`,5),this.plugin.betaPlugins.reloadPlugin(t.info)})}},{id:"disablePlugin",icon:"BratIcon",name:"Plugins: Disable a plugin - toggle it off",showInRibbon:!0,callback:()=>{let e=this.plugin.betaPlugins.getEnabledDisabledPlugins(!0).map(t=>({display:`${t.name} (${t.id})`,info:t.id})),n=new P(this.plugin);n.setSuggesterData(e),n.display(t=>{this.plugin.log(`${t.display} plugin disabled`,!1),this.plugin.settings.debuggingMode&&console.log(t.info),this.plugin.app.plugins.disablePluginAndSave(t.info)})}},{id:"enablePlugin",icon:"BratIcon",name:"Plugins: Enable a plugin - toggle it on",showInRibbon:!0,callback:()=>{let e=this.plugin.betaPlugins.getEnabledDisabledPlugins(!1).map(t=>({display:`${t.name} (${t.id})`,info:t.id})),n=new P(this.plugin);n.setSuggesterData(e),n.display(t=>{this.plugin.log(`${t.display} plugin enabled`,!1),this.plugin.app.plugins.enablePluginAndSave(t.info)})}},{id:"openGitHubZRepository",icon:"BratIcon",name:"Plugins: Open the GitHub repository for a plugin",showInRibbon:!0,callback:async()=>{let e=await Se(this.plugin.settings.debuggingMode);if(e){let n=Object.values(e).map(o=>({display:`Plugin: ${o.name}  (${o.repo})`,info:o.repo})),t=Object.values(this.plugin.settings.pluginList).map(o=>({display:`BRAT: ${o}`,info:o}));for(let o of n)t.push(o);let i=new P(this.plugin);i.setSuggesterData(t),i.display(o=>{o.info&&window.open(`https://github.com/${o.info}`)})}}},{id:"openGitHubRepoTheme",icon:"BratIcon",name:"Themes: Open the GitHub repository for a theme (appearance)",showInRibbon:!0,callback:async()=>{let e=await Ce(this.plugin.settings.debuggingMode);if(e){let n=Object.values(e).map(i=>({display:`Theme: ${i.name}  (${i.repo})`,info:i.repo})),t=new P(this.plugin);t.setSuggesterData(n),t.display(i=>{i.info&&window.open(`https://github.com/${i.info}`)})}}},{id:"opentPluginSettings",icon:"BratIcon",name:"Plugins: Open Plugin Settings Tab",showInRibbon:!0,callback:()=>{let e=this.plugin.app.setting,n=Object.values(e.pluginTabs).map(o=>({display:`Plugin: ${o.name}`,info:o.id})),t=new P(this.plugin),i=Object.values(e.settingTabs).map(o=>({display:`Core: ${o.name}`,info:o.id}));for(let o of n)i.push(o);t.setSuggesterData(i),t.display(o=>{e.open(),e.openTabById(o.info)})}},{id:"GrabBetaTheme",icon:"BratIcon",name:"Themes: Grab a beta theme for testing from a Github repository",showInRibbon:!0,callback:()=>{new F(this.plugin).open()}},{id:"updateBetaThemes",icon:"BratIcon",name:"Themes: Update beta themes",showInRibbon:!0,callback:async()=>{await D(this.plugin,!0)}},{id:"allCommands",icon:"BratIcon",name:"All Commands list",showInRibbon:!1,callback:()=>{this.ribbonDisplayCommands()}}];this.plugin=e;for(let n of this.bratCommands)this.plugin.addCommand({id:n.id,name:n.name,icon:n.icon,callback:()=>{n.callback()}})}ribbonDisplayCommands(){let e=[];for(let a of this.bratCommands)a.showInRibbon&&e.push({display:a.name,info:a.callback});let n=new P(this.plugin),t=this.plugin.app.setting,i=Object.values(t.settingTabs).map(a=>({display:`Core: ${a.name}`,info:()=>{t.open(),t.openTabById(a.id)}})),o=Object.values(t.pluginTabs).map(a=>({display:`Plugin: ${a.name}`,info:()=>{t.open(),t.openTabById(a.id)}}));e.push({display:"---- Core Plugin Settings ----",info:()=>{this.ribbonDisplayCommands()}});for(let a of i)e.push(a);e.push({display:"---- Plugin Settings ----",info:()=>{this.ribbonDisplayCommands()}});for(let a of o)e.push(a);n.setSuggesterData(e),n.display(a=>{typeof a.info=="function"&&a.info()})}};var y=require("obsidian");var de=(s,e)=>{let n=new DocumentFragment,t=document.createElement("a");if(t.textContent=s,t.href=`https://github.com/${s}`,n.appendChild(t),e){let i=document.createTextNode(e);n.appendChild(i)}return n},te=class extends y.PluginSettingTab{constructor(e,n){super(e,n),this.plugin=n}display(){let{containerEl:e}=this;e.empty(),new y.Setting(e).setName("Auto-enable plugins after installation").setDesc('If enabled beta plugins will be automatically enabled after installtion by default. Note: you can toggle this on and off for each plugin in the "Add Plugin" form.').addToggle(t=>{t.setValue(this.plugin.settings.enableAfterInstall),t.onChange(async i=>{this.plugin.settings.enableAfterInstall=i,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Auto-update plugins at startup").setDesc("If enabled all beta plugins will be checked for updates each time Obsidian starts. Note: this does not update frozen version plugins.").addToggle(t=>{t.setValue(this.plugin.settings.updateAtStartup),t.onChange(async i=>{this.plugin.settings.updateAtStartup=i,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Auto-update themes at startup").setDesc("If enabled all beta themes will be checked for updates each time Obsidian starts.").addToggle(t=>{t.setValue(this.plugin.settings.updateThemesAtStartup),t.onChange(async i=>{this.plugin.settings.updateThemesAtStartup=i,await this.plugin.saveSettings()})}),B(e,!0),e.createEl("hr"),new y.Setting(e).setName("Beta plugin list").setHeading(),e.createEl("div",{text:'The following is a list of beta plugins added via the command palette "Add a beta plugin for testing" or "Add a beta plugin with frozen version for testing". A frozen version is a specific release of a plugin based on its release tag. '}),e.createEl("p"),e.createEl("div",{text:"Click the x button next to a plugin to remove it from the list."}),e.createEl("p"),e.createEl("span").createEl("b",{text:"Note: "}),e.createSpan({text:"This does not delete the plugin, this should be done from the  Community Plugins tab in Settings."}),new y.Setting(e).addButton(t=>{t.setButtonText("Add Beta plugin"),t.onClick(()=>{this.plugin.app.setting.close(),this.plugin.betaPlugins.displayAddNewPluginModal(!0,!1)})});let n=new Set(this.plugin.settings.pluginSubListFrozenVersion.map(t=>t.repo));for(let t of this.plugin.settings.pluginList)n.has(t)||new y.Setting(e).setName(de(t)).addButton(i=>{i.setIcon("cross"),i.setTooltip("Delete this beta plugin"),i.onClick(()=>{if(i.buttonEl.textContent==="")i.setButtonText("Click once more to confirm removal");else{let{buttonEl:o}=i,{parentElement:a}=o;a!=null&&a.parentElement&&(a.parentElement.remove(),this.plugin.betaPlugins.deletePlugin(t))}})});new y.Setting(e).addButton(t=>{t.setButtonText("Add Beta plugin with frozen version"),t.onClick(()=>{this.plugin.app.setting.close(),this.plugin.betaPlugins.displayAddNewPluginModal(!0,!0)})});for(let t of this.plugin.settings.pluginSubListFrozenVersion)new y.Setting(e).setName(de(t.repo,` (version ${t.version})`)).addButton(i=>{i.setIcon("edit"),i.setTooltip("Change version"),i.onClick(()=>{this.plugin.app.setting.close(),this.plugin.betaPlugins.displayAddNewPluginModal(!0,!0,t.repo)})}).addButton(i=>{i.setIcon("cross"),i.setTooltip("Delete this beta plugin"),i.onClick(()=>{if(i.buttonEl.textContent==="")i.setButtonText("Click once more to confirm removal");else{let{buttonEl:o}=i,{parentElement:a}=o;a!=null&&a.parentElement&&(a.parentElement.remove(),this.plugin.betaPlugins.deletePlugin(t.repo))}})});new y.Setting(e).setName("Beta themes list").setHeading(),new y.Setting(e).addButton(t=>{t.setButtonText("Add Beta Theme"),t.onClick(()=>{this.plugin.app.setting.close(),new F(this.plugin).open()})});for(let t of this.plugin.settings.themesList)new y.Setting(e).setName(de(t.repo)).addButton(i=>{i.setIcon("cross"),i.setTooltip("Delete this beta theme"),i.onClick(()=>{if(i.buttonEl.textContent==="")i.setButtonText("Click once more to confirm removal");else{let{buttonEl:o}=i,{parentElement:a}=o;a!=null&&a.parentElement&&(a.parentElement.remove(),X(this.plugin,t.repo))}})});new y.Setting(e).setName("Monitoring").setHeading(),new y.Setting(e).setName("Enable Notifications").setDesc("BRAT will provide popup notifications for its various activities. Turn this off means  no notifications from BRAT.").addToggle(t=>{t.setValue(this.plugin.settings.notificationsEnabled),t.onChange(async i=>{this.plugin.settings.notificationsEnabled=i,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Enable Logging").setDesc("Plugin updates will be logged to a file in the log file.").addToggle(t=>{t.setValue(this.plugin.settings.loggingEnabled),t.onChange(async i=>{this.plugin.settings.loggingEnabled=i,await this.plugin.saveSettings()})}),new y.Setting(this.containerEl).setName("BRAT Log File Location").setDesc("Logs will be saved to this file. Don't add .md to the file name.").addSearch(t=>{t.setPlaceholder("Example: BRAT-log").setValue(this.plugin.settings.loggingPath).onChange(async i=>{this.plugin.settings.loggingPath=i,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Enable Verbose Logging").setDesc("Get a lot  more information in  the log.").addToggle(t=>{t.setValue(this.plugin.settings.loggingVerboseEnabled),t.onChange(async i=>{this.plugin.settings.loggingVerboseEnabled=i,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Debugging Mode").setDesc("Atomic Bomb level console logging. Can be used for troubleshoting and development.").addToggle(t=>{t.setValue(this.plugin.settings.debuggingMode),t.onChange(async i=>{this.plugin.settings.debuggingMode=i,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Personal Access Token").setDesc("If you need to access private repositories, enter the personal access token here.").addText(t=>{var i;t.setPlaceholder("Enter your personal access token").setValue((i=this.plugin.settings.personalAccessToken)!=null?i:"").onChange(async o=>{this.plugin.settings.personalAccessToken=o,await this.plugin.saveSettings()})})}};var Me=require("obsidian");function $e(){(0,Me.addIcon)("BratIcon",'<path fill="currentColor" stroke="currentColor"  d="M 41.667969 41.667969 C 41.667969 39.367188 39.800781 37.5 37.5 37.5 C 35.199219 37.5 33.332031 39.367188 33.332031 41.667969 C 33.332031 43.96875 35.199219 45.832031 37.5 45.832031 C 39.800781 45.832031 41.667969 43.96875 41.667969 41.667969 Z M 60.417969 58.582031 C 59.460938 58.023438 58.320312 57.867188 57.25 58.148438 C 56.179688 58.429688 55.265625 59.125 54.707031 60.082031 C 53.746094 61.777344 51.949219 62.820312 50 62.820312 C 48.050781 62.820312 46.253906 61.777344 45.292969 60.082031 C 44.734375 59.125 43.820312 58.429688 42.75 58.148438 C 41.679688 57.867188 40.539062 58.023438 39.582031 58.582031 C 37.597656 59.726562 36.910156 62.257812 38.042969 64.25 C 40.5 68.53125 45.0625 71.171875 50 71.171875 C 54.9375 71.171875 59.5 68.53125 61.957031 64.25 C 63.089844 62.257812 62.402344 59.726562 60.417969 58.582031 Z M 62.5 37.5 C 60.199219 37.5 58.332031 39.367188 58.332031 41.667969 C 58.332031 43.96875 60.199219 45.832031 62.5 45.832031 C 64.800781 45.832031 66.667969 43.96875 66.667969 41.667969 C 66.667969 39.367188 64.800781 37.5 62.5 37.5 Z M 50 8.332031 C 26.988281 8.332031 8.332031 26.988281 8.332031 50 C 8.332031 73.011719 26.988281 91.667969 50 91.667969 C 73.011719 91.667969 91.667969 73.011719 91.667969 50 C 91.667969 26.988281 73.011719 8.332031 50 8.332031 Z M 50 83.332031 C 33.988281 83.402344 20.191406 72.078125 17.136719 56.363281 C 14.078125 40.644531 22.628906 24.976562 37.5 19.042969 C 37.457031 19.636719 37.457031 20.238281 37.5 20.832031 C 37.5 27.738281 43.097656 33.332031 50 33.332031 C 52.300781 33.332031 54.167969 31.46875 54.167969 29.167969 C 54.167969 26.867188 52.300781 25 50 25 C 47.699219 25 45.832031 23.132812 45.832031 20.832031 C 45.832031 18.53125 47.699219 16.667969 50 16.667969 C 68.410156 16.667969 83.332031 31.589844 83.332031 50 C 83.332031 68.410156 68.410156 83.332031 50 83.332031 Z M 50 83.332031 " />')}var U=class{constructor(e){this.console=(e,...n)=>{console.log(`BRAT: ${e}`,...n)};this.themes={themeseCheckAndUpates:async e=>{await D(this.plugin,e)},themeInstallTheme:async e=>{let n=e.replace("https://github.com/","");await z(this.plugin,n,!0)},themesDelete:e=>{let n=e.replace("https://github.com/","");X(this.plugin,n)},grabCommmunityThemeCssFile:async(e,n=!1)=>await L(e,n,this.plugin.settings.debuggingMode),grabChecksumOfThemeCssFile:async(e,n=!1)=>await x(e,n,this.plugin.settings.debuggingMode),grabLastCommitDateForFile:async(e,n)=>await Fe(e,n)};this.plugin=e}};var Q=require("obsidian"),Ke=at(Qe());async function Ge(s,e,n=!1){if(s.settings.debuggingMode&&console.log(`BRAT: ${e}`),s.settings.loggingEnabled){if(!s.settings.loggingVerboseEnabled&&n)return;let t=`${s.settings.loggingPath}.md`,i=`[[${(0,Q.moment)().format((0,Ke.getDailyNoteSettings)().format).toString()}]] ${(0,Q.moment)().format("HH:mm")}`,o=window.require("os"),a=Q.Platform.isDesktop?o.hostname():"MOBILE",l=`${i} ${a} ${e.replace(`
`," ")}
`,g=s.app.vault.getAbstractFileByPath(t);g?await s.app.vault.append(g,l):g=await s.app.vault.create(t,l)}}var ne=class extends Ze.Plugin{constructor(){super(...arguments);this.APP_NAME="BRAT";this.APP_ID="obsidian42-brat";this.settings=ue;this.betaPlugins=new O(this);this.commands=new V(this);this.bratApi=new U(this);this.obsidianProtocolHandler=n=>{if(!n.plugin&&!n.theme){c(this,"Could not locate the repository from the URL.",10);return}for(let t of["plugin","theme"])if(n[t]){let i=t==="plugin"?new N(this,this.betaPlugins):new F(this);i.address=n[t],i.open();return}}}onload(){console.log(`loading ${this.APP_NAME}`),$e(),this.addRibbonIcon("BratIcon","BRAT",()=>{this.commands.ribbonDisplayCommands()}),this.loadSettings().then(()=>{this.app.workspace.onLayoutReady(()=>{this.addSettingTab(new te(this.app,this)),this.registerObsidianProtocolHandler("brat",this.obsidianProtocolHandler),this.settings.updateAtStartup&&setTimeout(()=>{this.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!1)},6e4),this.settings.updateThemesAtStartup&&setTimeout(()=>{D(this,!1)},12e4),setTimeout(()=>{window.bratAPI=this.bratApi},500)})}).catch(n=>{console.error("Failed to load settings:",n)})}async log(n,t=!1){await Ge(this,n,t)}onunload(){console.log(`unloading ${this.APP_NAME}`)}async loadSettings(){this.settings=Object.assign({},ue,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
